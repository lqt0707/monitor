# AI 诊断模块使用说明

## 概述

AI 诊断模块是一个集成在错误监控系统中的智能分析工具，使用@ant-design/x 组件实现，能够自动分析 JavaScript/TypeScript 错误并提供智能诊断和修复建议。

## 主要功能

### 1. 智能错误诊断

- **自动分析错误堆栈**：AI 模型自动解析错误堆栈信息，识别错误的根本原因
- **上下文感知**：结合源代码位置和项目信息，提供更准确的诊断
- **多维度分析**：从错误类型、发生频率、影响范围等多个维度进行分析

### 2. 错误代码定位

- **精确位置识别**：自动识别错误发生的具体文件、行号和列号
- **函数级定位**：识别错误发生的具体函数或方法
- **源代码关联**：与源代码管理系统集成，提供完整的代码上下文

### 3. 智能修复建议

- **针对性建议**：根据错误类型和上下文提供具体的修复步骤
- **最佳实践推荐**：结合行业最佳实践，提供预防性建议
- **代码示例**：提供可执行的代码修复示例

### 4. 诊断记录管理

- **历史记录保存**：自动保存所有 AI 诊断结果，支持历史查询
- **结果覆盖机制**：新诊断结果自动覆盖旧记录，保持信息最新
- **时间戳记录**：记录每次诊断的时间，便于追踪问题解决进度

## 技术架构

### 前端组件

- **@ant-design/x**：使用最新的 AI 对话组件，提供流畅的用户交互体验
- **React Hooks**：使用 useState 和 useEffect 管理组件状态和副作用
- **Ant Design**：提供统一的 UI 组件和样式系统

### 后端服务

- **NestJS**：提供 RESTful API 接口
- **DeepSeek AI**：集成大语言模型进行智能分析
- **队列系统**：异步处理诊断任务，提高系统响应性

### 数据存储

- **TypeORM**：管理诊断结果和历史的数据库操作
- **JSON 存储**：灵活存储 AI 诊断的结构化数据

## 使用方法

### 1. 访问 AI 诊断

1. 在错误详情页面中，点击"AI 诊断"标签页
2. 系统会自动加载已有的诊断结果（如果有的话）
3. 如果没有诊断结果，会显示"开始 AI 诊断"按钮

### 2. 触发 AI 诊断

1. 点击"开始 AI 诊断"按钮
2. 系统会显示诊断进度，包括：
   - 正在分析错误堆栈信息
   - 正在识别错误类型和上下文
   - 正在生成修复建议
3. 诊断完成后，结果会自动显示

### 3. 查看诊断结果

诊断结果包含以下信息：

- **严重程度**：高/中/低，帮助判断问题的优先级
- **错误分析**：详细的错误原因分析
- **可能原因**：列出可能导致错误的多个原因
- **修复建议**：具体的修复步骤和建议
- **预防措施**：如何避免类似错误再次发生
- **代码定位**：错误发生的具体位置信息

### 4. 管理诊断记录

- **重新诊断**：点击"重新诊断"按钮可以重新分析错误
- **刷新结果**：点击"刷新结果"按钮可以获取最新的诊断状态
- **历史查看**：在诊断历史卡片中查看诊断时间线

## 配置说明

### 环境变量

```bash
# AI诊断服务配置
VITE_API_BASE_URL=http://localhost:3001
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com
```

### 项目配置

在项目配置中可以启用/禁用 AI 诊断功能：

```json
{
  "enableAiDiagnosis": true,
  "aiDiagnosisThreshold": 0.7,
  "maxDiagnosisHistory": 10
}
```

## 最佳实践

### 1. 错误信息完整性

- 确保错误堆栈信息完整
- 提供足够的上下文信息
- 包含项目版本和源代码信息

### 2. 诊断结果验证

- 结合实际情况验证 AI 诊断结果
- 不要完全依赖 AI 建议，要结合专业知识
- 定期更新和优化诊断模型

### 3. 性能优化

- 使用队列系统处理大量诊断请求
- 实现诊断结果缓存机制
- 监控 AI 服务的响应时间和成功率

## 故障排除

### 常见问题

1. **AI 诊断失败**

   - 检查网络连接
   - 验证 API 密钥配置
   - 查看服务器日志

2. **诊断结果不准确**

   - 检查错误信息是否完整
   - 确认源代码是否正确上传
   - 考虑重新触发诊断

3. **响应时间过长**
   - 检查 AI 服务状态
   - 优化队列配置
   - 考虑增加并发处理能力

### 日志查看

```bash
# 查看AI诊断服务日志
tail -f logs/ai-diagnosis.log

# 查看错误详情
grep "AI诊断" logs/error.log
```

## 更新日志

### v1.0.0 (2024-01-XX)

- 初始版本发布
- 支持基本的 AI 诊断功能
- 集成 DeepSeek AI 模型
- 实现诊断历史记录管理

### 计划功能

- 支持多种 AI 模型
- 增加诊断结果导出功能
- 实现诊断结果评分系统
- 添加团队协作功能

## 技术支持

如有问题或建议，请联系开发团队：

- 邮箱：support@example.com
- 文档：https://docs.example.com/ai-diagnosis
- 问题反馈：https://github.com/example/monitor/issues
