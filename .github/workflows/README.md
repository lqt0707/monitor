# ⚙️ GitHub Actions 工作流配置

本仓库使用 GitHub Actions 实现 SDK 的自动化构建、测试和发布。

## 🔄 工作流概览

### 主要工作流：`auto-publish.yml`

**功能**: 自动化发布 SDK 到 npm，包含完整的 CI/CD 流程

**触发条件**:

- 推送到 `main` 或 `master` 分支
- 修改了 `sdk/` 目录下的文件
- 创建了新的 GitHub Release
- 手动触发 (`workflow_dispatch`)

**工作流程**:

1. **版本检测** - 检测 package.json 中的版本变化
2. **条件构建** - 只在版本变化时执行构建和测试
3. **自动发布** - 发布所有包到 npm
4. **创建 Release** - 在 GitHub 上创建版本发布
5. **更新日志** - 自动更新 CHANGELOG.md

## 🎯 工作流特点

### ✅ 优势

- **智能触发**: 只在版本变化时执行发布流程
- **资源节约**: 避免不必要的构建和测试
- **流程完整**: 从构建到发布的全自动化
- **错误处理**: 完善的错误检测和报告
- **并行执行**: 多个任务并行运行，提高效率

### 🔧 技术特性

- 使用 Node.js 20.x
- 支持 npm 缓存优化
- 完整的构建产物验证
- 自动类型检查和测试
- 多包并行发布

## 📋 使用说明

### 自动发布流程

1. 更新 SDK 版本号
2. 提交代码到 main 分支
3. 工作流自动检测版本变化
4. 执行构建、测试和发布
5. 创建 GitHub Release 和更新日志

### 手动触发

在 GitHub 仓库的 Actions 页面，可以手动触发工作流：

1. 选择 `Auto Publish SDK` 工作流
2. 点击 `Run workflow` 按钮
3. 选择分支和触发原因

## 🔍 监控和调试

### 查看执行状态

- 访问 `https://github.com/{用户名}/{仓库名}/actions`
- 查看 `Auto Publish SDK` 工作流的执行历史

### 日志分析

- 每个步骤都有详细的日志输出
- 失败时会显示具体的错误信息
- 支持下载完整的日志文件

## 🚨 故障排除

### 常见问题

1. **构建失败**: 检查 TypeScript 编译错误和依赖问题
2. **发布失败**: 验证 NPM_TOKEN 配置和包名可用性
3. **版本检测失败**: 确保 package.json 格式正确

### 紧急处理

如果自动发布失败，可以：

1. 查看 Actions 日志了解具体错误
2. 手动执行构建和发布命令
3. 检查 npm 包状态和 GitHub Release

## 📚 相关文档

- [SDK 自动发布说明](../../sdk/AUTO_PUBLISH_README.md)
- [发布检查清单](../../sdk/PUBLISH_CHECKLIST.md)
- [变更日志](../../sdk/CHANGELOG.md)

---

**注意**: 本工作流已优化为只保留必要的功能，删除了冗余的配置，确保高效可靠的自动化发布流程。
