<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor SDK Web 使用示例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .example-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background: #f8f9fa;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .button {
            background: #0366d6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .button:hover {
            background: #0256cc;
        }

        .button.danger {
            background: #d73a49;
        }

        .button.danger:hover {
            background: #cb2431;
        }

        .status {
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }

        .log {
            background: #fffbdd;
            border: 1px solid #ffd33d;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        h1 {
            color: #24292e;
        }

        h2 {
            color: #0366d6;
            border-bottom: 2px solid #e1e4e8;
            padding-bottom: 10px;
        }

        h3 {
            color: #586069;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🚀 Monitor SDK Web 使用示例</h1>

        <div class="example-section">
            <h2>📦 安装方式对比</h2>
            <h3>推荐方式（Web专用包）</h3>
            <div class="code-block">npm install @monitor/web-sdk
                import Monitor from '@monitor/web-sdk';</div>

            <h3>通用方式（多平台包）</h3>
            <div class="code-block">npm install @monitor/sdk
                import Monitor from '@monitor/sdk';</div>

            <div class="status">
                💡 <strong>包大小对比：</strong><br>
                • @monitor/web-sdk: ~15KB (推荐Web项目使用)<br>
                • @monitor/sdk: ~20KB (支持多平台自动检测)
            </div>
        </div>

        <div class="example-section">
            <h2>🎯 快速开始示例</h2>

            <h3>方式1: 使用配置模板（推荐）</h3>
            <div class="code-block">import Monitor, { Templates } from '@monitor/web-sdk';

                // 使用Web基础模板
                const config = Templates.createConfig(Templates.WebBasic, {
                projectId: 'demo-project',
                serverUrl: 'https://api.example.com'
                });

                Monitor.init(config);</div>

            <h3>方式2: 一键快速开始</h3>
            <div class="code-block">import Monitor from '@monitor/web-sdk';

                // 超简单的使用方式
                Monitor.quickStart.web('demo-project', 'https://api.example.com');</div>

            <h3>方式3: 自定义配置</h3>
            <div class="code-block">import Monitor from '@monitor/web-sdk';

                Monitor.init({
                projectId: 'demo-project',
                serverUrl: 'https://api.example.com',

                // 错误监控
                error: {
                enabled: true,
                captureConsole: true,
                maxErrors: 100
                },

                // 性能监控
                performance: {
                enabled: true,
                captureNavigation: true,
                captureLCP: true
                },

                // 行为监控
                behavior: {
                enabled: true,
                captureClicks: true,
                capturePageViews: true
                }
                });</div>
        </div>

        <div class="example-section">
            <h2>🧪 实时测试</h2>
            <p>在浏览器控制台中可以看到SDK的初始化和运行日志。</p>

            <div id="sdk-status" class="status">
                SDK状态：<span id="status-text">未初始化</span>
            </div>

            <div>
                <button class="button" onclick="initSDK()">初始化 SDK</button>
                <button class="button" onclick="testError()">测试错误捕获</button>
                <button class="button" onclick="testPerformance()">测试性能记录</button>
                <button class="button" onclick="testBehavior()">测试行为记录</button>
                <button class="button danger" onclick="testErrorCapture()">触发错误</button>
                <button class="button" onclick="getStatus()">获取状态</button>
                <button class="button" onclick="clearLog()">清空日志</button>
            </div>

            <div id="log" class="log">
                日志输出区域...
                点击上方按钮测试不同功能
            </div>
        </div>

        <div class="example-section">
            <h2>💡 最佳实践</h2>

            <h3>1. 环境区分</h3>
            <div class="code-block">// 只在生产环境启用
                if (process.env.NODE_ENV === 'production') {
                Monitor.init(config);
                }</div>

            <h3>2. 错误过滤</h3>
            <div class="code-block">Monitor.init({
                // ...其他配置
                error: {
                enabled: true,
                filters: [
                // 过滤掉第三方脚本错误
                error => !error.message.includes('Script error'),
                // 过滤掉开发环境错误
                error => !error.stack?.includes('webpack')
                ]
                }
                });</div>

            <h3>3. 性能监控配置</h3>
            <div class="code-block">Monitor.init({
                // ...其他配置
                performance: {
                enabled: true,
                thresholds: {
                lcp: 2500, // LCP阈值 2.5秒
                fcp: 1800 // FCP阈值 1.8秒
                },
                sampleRate: 0.1 // 10%采样率
                }
                });</div>

            <h3>4. 自定义标签</h3>
            <div class="code-block">Monitor.init({
                // ...其他配置
                tags: {
                version: '1.2.3',
                feature: 'checkout',
                experiment: 'variant-a'
                }
                });</div>
        </div>

        <div class="example-section">
            <h2>🔧 常见问题解决</h2>

            <h3>问题1：包体积过大</h3>
            <div class="status">
                <strong>解决方案：</strong> 使用平台专用包<br>
                • Web项目：<code>@monitor/web-sdk</code> (15KB)<br>
                • Taro项目：<code>@monitor/taro-sdk</code> (12KB)
            </div>

            <h3>问题2：TypeScript类型问题</h3>
            <div class="code-block">// 确保安装了类型定义
                npm install @types/node

                // 在tsconfig.json中添加
                {
                "compilerOptions": {
                "moduleResolution": "node",
                "esModuleInterop": true
                }
                }</div>

            <h3>问题3：构建错误</h3>
            <div class="status">
                <strong>常见原因：</strong><br>
                • 缺少必要的polyfill<br>
                • 打包工具配置问题<br>
                • 依赖版本冲突<br><br>
                <strong>解决方案：</strong> 查看 <code>./TROUBLESHOOTING.md</code>
            </div>
        </div>
    </div>

    <script>
        // 模拟Monitor SDK（用于演示）
        let isInitialized = false;
        let mockMonitor = null;

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[Monitor Demo] ${message}`);
        }

        function updateStatus(status) {
            document.getElementById('status-text').textContent = status;
        }

        function clearLog() {
            document.getElementById('log').textContent = '日志已清空...\n';
        }

        function initSDK() {
            if (isInitialized) {
                log('SDK 已经初始化过了');
                return;
            }

            log('🚀 正在初始化 Monitor SDK...');
            log('🌐 检测到 Web 环境');
            log('✅ SDK 初始化成功');

            // 模拟SDK对象
            mockMonitor = {
                captureError: (error, extra) => {
                    log(`📝 捕获错误: ${error.message}`);
                    if (extra) log(`   额外信息: ${JSON.stringify(extra)}`);
                },
                recordPerformance: (name, metrics) => {
                    log(`⚡ 记录性能: ${name} - ${JSON.stringify(metrics)}`);
                },
                recordBehavior: (event, data) => {
                    log(`👆 记录行为: ${event} - ${JSON.stringify(data || {})}`);
                },
                getStatus: () => ({
                    initialized: true,
                    enabled: true,
                    queue: { size: 3, maxSize: 100 },
                    errorMonitor: true,
                    performanceMonitor: true,
                    behaviorMonitor: true
                })
            };

            isInitialized = true;
            updateStatus('已初始化 ✅');
        }

        function testError() {
            if (!isInitialized) {
                log('❌ 请先初始化SDK');
                return;
            }

            const error = new Error('这是一个测试错误');
            mockMonitor.captureError(error, {
                userId: '12345',
                page: '/demo',
                action: 'test'
            });
        }

        function testPerformance() {
            if (!isInitialized) {
                log('❌ 请先初始化SDK');
                return;
            }

            mockMonitor.recordPerformance('page_load', {
                duration: 1234,
                lcp: 1800,
                fcp: 900
            });
        }

        function testBehavior() {
            if (!isInitialized) {
                log('❌ 请先初始化SDK');
                return;
            }

            mockMonitor.recordBehavior('button_click', {
                buttonText: '测试按钮',
                page: '/demo'
            });
        }

        function testErrorCapture() {
            if (!isInitialized) {
                log('❌ 请先初始化SDK');
                return;
            }

            // 故意触发一个错误来测试自动捕获
            try {
                throw new Error('这是一个故意触发的错误');
            } catch (error) {
                mockMonitor.captureError(error, {
                    type: 'intentional',
                    source: 'demo'
                });
            }
        }

        function getStatus() {
            if (!isInitialized) {
                log('❌ 请先初始化SDK');
                return;
            }

            const status = mockMonitor.getStatus();
            log(`📊 SDK状态: ${JSON.stringify(status, null, 2)}`);
        }

        // 页面加载完成时的提示
        window.addEventListener('load', () => {
            log('🎉 Demo页面加载完成');
            log('💡 提示：点击"初始化 SDK"开始测试');
        });
    </script>
</body>

</html>